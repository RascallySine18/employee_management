/*
Программа для управления списком сотрудников с динамическим выделением памяти.
Поддерживает сортировку, добавление, удаление и редактирование сотрудников.
Данные загружаются из файла in.txt и могут быть сохранены в различные файлы.
Выполнил Базан Игорь 303ИС-22

Программа предназначена для управления базой данных сотрудников, содержащей информацию
об айди, отделе, фамилии, зарплате, дате приема и дате увольнения.
Основные возможности:
1. Чтение данных из файла in.txt с динамическим выделением памяти для массива сотрудников.
2. Сортировка сотрудников по ID, имени или зарплате.
3. Сохранение отсортированных данных в текстовые файлы
(sorted_by_id.txt, sorted_by_name.txt, sorted_by_salary.txt).
4. Добавление, удаление и редактирование записей через меню.
5. Вывод списка сотрудников на экран.

Тестирование программы:
Для проверки корректности работы программы используются следующие шаги тестирования:
1. Подготовка входного файла:
- Создать файл in.txt с содержимым:
5 OGK Ivanov 80 25.02.2018 28.03.2024
2 OGT Petrov 100 26.02.2018 28.03.2025
3 OGBuh Dryahlova 150 12.03.2011 20.04.2025
4 OGK Vanyan 70 15.02.2013 11.03.2021
2. Проверка чтения данных:
- Запустить программу, выбрать пункт меню 7 (вывод списка).
- Ожидаемый вывод:
5 OGK Ivanov 80 25.2.2018 28.3.2024
2 OGT Petrov 100 26.2.2018 28.3.2025
3 OGBuh Dryahlova 150 12.3.2011 20.4.2025
4 OGK Vanyan 70 15.2.2013 11.3.2021
3. Проверка сортировки по ID (пункт меню 1):
- Выбрать пункт 1, проверить содержимое файла sorted_by_id.txt:
2 OGT Petrov 100 26.2.2018 28.3.2025
3 OGBuh Dryahlova 150 12.3.2011 20.4.2025
4 OGK Vanyan 70 15.2.2013 11.3.2021
5 OGK Ivanov 80 25.2.2018 28.3.2024
- Проверить вывод на экран (аналогичен содержимому файла).
4. Проверка сортировки по имени (пункт меню 2):
- Выбрать пункт 2, проверить содержимое файла sorted_by_name.txt:
3 OGBuh Dryahlova 150 12.3.2011 20.4.2025
5 OGK Ivanov 80 25.2.2018 28.3.2024
2 OGT Petrov 100 26.2.2018 28.3.2025
4 OGK Vanyan 70 15.2.2013 11.3.2021
5. Проверка сортировки по зарплате (пункт меню 3):
- Выбрать пункт 3, проверить содержимое файла sorted_by_salary.txt:
4 OGK Vanyan 70 15.2.2013 11.3.2021
5 OGK Ivanov 80 25.2.2018 28.3.2024
2 OGT Petrov 100 26.2.2018 28.3.2025
3 OGBuh Dryahlova 150 12.3.2011 20.4.2025
6. Проверка добавления сотрудника (пункт меню 4):
- Выбрать пункт 4, ввести данные: 6 OGM Sidorov 90 01.01.2020 31.12.2025
- Выбрать пункт 7, проверить, что новая запись появилась:
4 OGK Vanyan 70 15.2.2013 11.3.2021
5 OGK Ivanov 80 25.2.2018 28.3.2024
2 OGT Petrov 100 26.2.2018 28.3.2025
3 OGBuh Dryahlova 150 12.3.2011 20.4.2025
6 OGM Sidorov 90 1.1.2020 31.12.2025
7. Проверка удаления сотрудника (пункт меню 5):
- Выбрать пункт 5, ввести ID: 2
- Проверить с помощью пункта 7,
что запись удалена, а последняя запись (Sidorov) перемещена:
4 OGK Vanyan 70 15.2.2013 11.3.2021
5 OGK Ivanov 80 25.2.2018 28.3.2024
6 OGM Sidorov 90 1.1.2020 31.12.2025
3 OGBuh Dryahlova 150 12.3.2011 20.4.2025
8. Проверка редактирования сотрудника (пункт меню 6):
- Выбрать пункт 6, ввести ID: 5
- Ввести новые данные: OGM Ivanov 120 01.01.2019 31.12.2024
- Проверить с помощью пункта 7, что запись обновлена:
4 OGK Vanyan 70 15.2.2013 11.3.2021
5 OGM Ivanov 120 1.1.2019 31.12.2024
6 OGM Sidorov 90 1.1.2020 31.12.2025
3 OGBuh Dryahlova 150 12.3.2011 20.4.2025
9. Проверка выхода (пункт меню 0):
- Выбрать пункт 0, убедиться,
что программа завершает работу с сообщением "Выход...".
*Примечания:
- Если запись с указанным ID не найдена
(например, при удалении или редактировании),
программа должна вывести сообщение об ошибке.
- При некорректном вводе данных
(например, при добавлении или редактировании)
программа сообщает об ошибке ввода.
- Для проверки файлов рекомендуется использовать текстовый редактор
или команды cat (Linux) / type (Windows).
- Память освобождается корректно при выходе из программы.
*/

#include <stdio.h>
#include <stdlib.h>
#include <locale.h>
#include "person.h"

/*
Основная функция программы.
Управляет списком сотрудников через меню.
Загружает данные из файла, выполняет операции и освобождает память.
*/
int main() {
	setlocale(LC_ALL, "Russian");
	int count = 0, capacity = 0;
	person *ar = load_from_file("in.txt", &count, &capacity);
	if (ar == NULL) {
		printf("Не удалось загрузить данные. Программа завершена.\n");
		return 1;
	}
	int choice;
	do {
		print_menu();
		if (scanf("%d", &choice) != 1) {
			printf("Неверный ввод!\n");
			while (getchar() != '\n');
			continue;
		}
		switch (choice) {
		case 1:
			//Сортировка по ID, сохранение в файл и вывод списка.
			sort_by_id(ar, count);
			save_to_file(ar, count, "sorted_by_id.txt");
			ar_print(ar, count);
			break;
		case 2:
			//Сортировка по имени, сохранение в файл и вывод списка.
			sort_by_name(ar, count);
			save_to_file(ar, count, "sorted_by_name.txt");
			ar_print(ar, count);
			break;
		case 3:
			//Сортировка по зарплате, сохранение в файл и вывод списка.
			sort_by_salary(ar, count);
			save_to_file(ar, count, "sorted_by_salary.txt");
			ar_print(ar, count);
			break;
		case 4:
			//Добавление нового сотрудника и вывод обновленного списка.
			ar = add_person(ar, &count, &capacity);
			ar_print(ar, count);
			break;
		case 5:
			//Удаление сотрудника по ID и вывод обновленного списка.
			ar = delete_person(ar, &count);
			ar_print(ar, count);
			break;
		case 6:
			//Редактирование сотрудника по ID и вывод обновленного списка.
			ar = edit_person(ar, count);
			ar_print(ar, count);
			break;
		case 7:
			//Вывод текущего списка сотрудников.
			ar_print(ar, count);
			break;
		case 0:
			//Выход из программы.
			printf("Выход...\n");
			break;
		default:
			printf("Неверный выбор!\n");
		}
	} while (choice != 0);
	free(ar); //Освобождение выделенной памяти.
	return 0;
}
